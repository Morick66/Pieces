<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pieces</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <main>
        <nav>
            <div class="title">Pieces</div>
        </nav>
        <div class="form-input">
            <form action="{{ url_for('add_idea') }}" method="POST" enctype="multipart/form-data" onsubmit="setLocalTimestamp();handleSubmit(event);">
                <textarea name="idea" id="" oninput="autoResize(this)" placeholder="想分享点什么?"></textarea>
                <br>
                <div id="preview"></div>
                <input type="hidden" name="local_timestamp" id="localTimestamp">
                <div class="footer-form">
                    <input type="file" id="fileInput" name="files" accept="image/*" multiple onchange="handleFiles(this.files)" style="display: none;">
                    <button type="button" onclick="document.getElementById('fileInput').click();">选择图片</button>
                    <div class="button-box">
                        <button type="submit">
                            <svg t="1721134812269" class="icon" fill="#333333" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6354" width="200" height="200"><path d="M512 0.001287c-282.769282 0-511.998713 229.229431-511.998713 511.998713 0 282.769282 229.229431 511.998713 511.998713 511.998713 282.767995 0 511.998713-229.228144 511.998713-511.998713C1023.998713 229.230718 794.767995 0.001287 512 0.001287zM748.560448 544.492778 542.994656 544.492778l0 205.560645c0 17.279887-13.946437 31.226324-31.221176 31.226324-17.279887 0-31.226324-13.946437-31.226324-31.226324L480.547156 544.492778l-205.559357 0c-17.279887 0-31.226324-13.946437-31.226324-31.226324s13.946437-31.226324 31.226324-31.226324l205.666182 0 0-205.559357c0-17.279887 13.94515-31.226324 31.219889-31.226324 17.279887 0 31.226324 13.946437 31.226324 31.226324L543.100194 482.041417l205.560645 0c17.17435 0 31.120786 13.946437 31.120786 31.226324S765.835188 544.492778 748.560448 544.492778z" p-id="6355"></path></svg>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <div class="pieces-list">
            {% for idea in ideas %}
            <div class="pieces-item">
                <div class="pieces-item-content">
                    {% if idea.idea %}  <!-- 检查文本是否存在并非空 -->
                    {{ idea.idea }}
                    {% endif %}
                    {% if idea.images %} <!-- 注意这里改为 images, 假设存的是多张图片的列表 -->
                    <div class="pieces-item-image">
                        {% for img in idea.images %}
                        <img src="{{ url_for('uploaded_file', filename=img) }}" alt="Image">
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div class="pieces-item-timestamp">
                    {{ idea.timestamp }}
                </div>
                <div class="pieces-item-buttons">
                    <!-- 编辑按钮，触发弹窗 -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editModal{{ idea.id }}">
                        <svg t="1721133764031" class="icon" fill="#3D3D3D" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4266" width="200" height="200"><path d="M684.202667 117.248c15.893333-15.872 42.154667-15.36 58.922666 1.408l90.517334 90.517333c16.661333 16.661333 17.344 42.986667 1.429333 58.922667l-445.653333 445.653333c-7.936 7.914667-23.104 16.746667-34.218667 19.776l-143.701333 39.253334c-21.909333 5.994667-35.114667-7.104-29.568-28.949334l37.248-146.773333c2.773333-10.944 11.562667-26.346667 19.392-34.176l445.653333-445.653333zM268.736 593.066667c-2.901333 2.901333-8.106667 12.074667-9.130667 16.021333l-29.12 114.773333 111.957334-30.570666c4.437333-1.216 13.632-6.549333 16.810666-9.728l445.653334-445.653334-90.517334-90.496-445.653333 445.653334zM682.794667 178.986667l90.517333 90.517333-30.186667 30.186667-90.496-90.517334 30.165334-30.165333z m-362.026667 362.048l90.496 90.517333-30.165333 30.165333-90.517334-90.496 30.165334-30.186666zM170.666667 874.666667c0-11.776 9.429333-21.333333 21.461333-21.333334h661.077333a21.333333 21.333333 0 1 1 0 42.666667H192.128A21.333333 21.333333 0 0 1 170.666667 874.666667z" p-id="4267"></path></svg>
                    </button>
                    <!-- 删除按钮 -->
                    <button type="button" class="btn btn-danger" onclick="deleteIdea('{{ idea.id }}')">
                        <svg t="1721133792868" class="icon" fill="#272636" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5281" width="200" height="200"><path d="M868.273 185.482l-67.6 0.033c-1.13-0.11-2.19-0.345-3.39-0.345-1.21 0-2.295 0.25-3.46 0.36l-232.584 0.11 0.075-41.622c0-20.655-17.215-37.382-37.865-37.382-3.335 0-6.16 0.28-9.08 0.502-3.157-0.222-6.175-0.502-9.817-0.502-20.64 0-37.382 16.725-37.382 37.382l0.175 41.67-226.822 0.11c-2.655-0.725-5.482-1.227-8.607-1.227-3.143 0-6 0.502-8.702 1.242l-66.8 0.018c-20.637 0-34.977 8.277-34.977 28.93 0 20.64 14.322 31.98 34.977 31.98l43.35-0.015 0.315 606.028c1.68 39.655 31.632 71.34 71.747 71.34l37.397 0 0 0.33 411.291-0.255 0-0.075 37.385 0c41.235 0 70.6-33.36 70.7-74.56l-0.33-603.108 40.005-0.015c20.64 0 37.385-11.325 37.385-31.98C905.658 193.777 888.923 185.482 868.273 185.482zM765.398 787.128c0.25 49.135-9.165 67.195-42.385 72.695l-424.849 0.25c-20.765-4.45-30.865-15.145-34.995-38l-0.297-575.381 502.506-0.252 0.31 613.338L765.398 787.128zM420.206 310.744c-17.355 0-31.415 14.055-31.415 31.412l0 424.081c0 17.36 14.06 31.415 31.415 31.415 17.34 0 31.415-14.055 31.415-31.415L451.621 342.157C451.621 324.799 437.546 310.744 420.206 310.744zM608.688 310.744c-17.36 0-31.415 14.055-31.415 31.412l0 424.081c0 17.36 14.055 31.415 31.415 31.415 17.335 0 31.41-14.055 31.41-31.415L640.098 342.157C640.098 324.799 626.023 310.744 608.688 310.744z" p-id="5282"></path></svg>
                    </button>
                </div>
            </div>
            {% include 'modal.html' %}
            {% endfor %}
        </div>
    </main>
    <script src="/static/js/timestampHandling.js"></script>
    <script src="/static/js/formHandling.js"></script>
    <script src="/static/js/ideaDeletion.js"></script>
    <script src="/static/js/modalHandling.js"></script>
    <script src="/static/js/modalControl.js"></script>
</body>
</html>
